<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="React2Shell (CVE-2025-55182) 脆弱性の検証記録">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self'; img-src 'self' data:;">
    <title>React2Shell (CVE-2025-55182) 脆弱性検証記録 | Security Research Blog</title>
    <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>
    <header class="header">
        <nav class="nav-container">
            <a href="../index.html" class="logo">Security Research Blog</a>
            <ul class="nav-menu">
                <li><a href="../index.html" class="nav-link">Home</a></li>
                <li><a href="index.html" class="nav-link active">Posts</a></li>
                <li><a href="../about.html" class="nav-link">About</a></li>
            </ul>
        </nav>
    </header>

    <main class="main-container">
        <div class="article-container">
            <header class="article-header">
                <h1 class="article-title">React2Shell (CVE-2025-55182) 脆弱性検証記録</h1>
                <div class="article-meta">
                    <time datetime="2025-12-16">2025年12月16日</time>
                    <div class="post-tags mt-2">
                        <span class="tag">脆弱性解析</span>
                        <span class="tag">CVE-2025-55182</span>
                        <span class="tag">React</span>
                    </div>
                </div>
            </header>

            <article class="article-content">
                <h2>概要</h2>
                <p>
                    本記録は、2025年12月3日に公開されたReact Server Componentsの脆弱性「React2Shell」(CVE-2025-55182)について、
                    隔離された検証環境において実施した脆弱性検証の結果をまとめたものです。
                </p>

                <h3>脆弱性の基本情報</h3>
                <ul>
                    <li><strong>脆弱性ID:</strong> CVE-2025-55182</li>
                    <li><strong>脆弱性名:</strong> React2Shell</li>
                    <li><strong>公開日:</strong> 2025年12月3日</li>
                    <li><strong>CVSSスコア:</strong> 10.0 (Critical)</li>
                    <li><strong>脆弱性の種類:</strong> 安全でないデシリアライゼーション</li>
                    <li><strong>発見者:</strong> Lachlan Davidson (Meta赤チーム)</li>
                </ul>

                <h3>影響範囲</h3>
                <p>以下のバージョンが影響を受けます：</p>
                <ul>
                    <li>React 19.0.0 - 19.2.0（19.1.2以降で修正）</li>
                    <li>Next.js 15.0.0 - 15.1.3（15.1.4以降で修正）</li>
                    <li>Next.js 16.0.0 - 16.0.6（16.1.0以降で修正）</li>
                </ul>
                <p>
                    注: Pages Routerのみを使用するアプリケーションは影響を受けません。
                    App RouterまたはReact Server Componentsを使用している場合のみ脆弱性が存在します。
                </p>

                <h2>検証環境</h2>
                <p>
                    本検証は完全に隔離されたネットワーク環境において実施しました。
                    VirtualBoxの内部ネットワーク機能を使用し、外部ネットワークへの接続を遮断しています。
                </p>

                <h3>システム構成</h3>
                <ul>
                    <li><strong>仮想化ソフトウェア:</strong> Oracle VirtualBox 7.x</li>
                    <li><strong>ゲストOS:</strong> Ubuntu 24.04.2 LTS (amd64)</li>
                    <li><strong>割り当てメモリ:</strong> 4GB</li>
                    <li><strong>ストレージ:</strong> 30GB (可変サイズ)</li>
                    <li><strong>ネットワーク:</strong> 内部ネットワーク（隔離環境）</li>
                </ul>

                <h3>ソフトウェアスタック</h3>
                <ul>
                    <li>Node.js 20.x</li>
                    <li>npm 10.x</li>
                    <li>Next.js 16.0.6（脆弱版検証用）</li>
                    <li>Next.js 16.1.0（パッチ版検証用）</li>
                    <li>Python 3.12（検証スクリプト実行）</li>
                </ul>

                <h3>検証ツール</h3>
                <p>
                    Assetnote社が公開しているReact2Shell Scannerを使用しました。
                    このツールは、数学演算（41 × 271 = 11111）を実行させることで、
                    リモートコード実行が可能かどうかを安全に検証します。
                </p>

                <h2>技術的詳細</h2>
                <p>
                    React2Shellは、React Server ComponentsのFlightプロトコルにおける
                    安全でないデシリアライゼーション処理に起因する脆弱性です。
                    攻撃者は特別に細工したHTTPリクエストを送信することで、サーバー上で任意のNode.jsコードを実行できます。
                </p>

                <h3>攻撃の仕組み</h3>
                <p>本脆弱性は以下のメカニズムで動作します：</p>
                <ul>
                    <li>特別に細工されたmultipart/form-dataリクエストを作成</li>
                    <li>["$K1"]形式のモジュール参照を含むペイロードを送信</li>
                    <li>constructorプロパティを通じてグローバルスコープにアクセス</li>
                    <li>node:moduleやnode:child_processをインポートしてコマンドを実行</li>
                </ul>

                <p>
                    核心は、Reactがモジュール参照を処理する際に使用するブラケット記法（moduleExports[metadata[2]]）にあります。
                    この処理では、JavaScriptのプロトタイプチェーン全体を辿るため、
                    constructorプロパティを介してグローバルスコープのFunctionコンストラクタにアクセスできます。
                </p>

                <h2>検証手順と結果</h2>

                <h3>脆弱版の検証（Next.js 16.0.6）</h3>
                <p>検証手順：</p>
                <ol>
                    <li>Next.js 16.0.6を使用したアプリケーションをlocalhost:3000で起動</li>
                    <li>Assetnote Scannerによる基本スキャンを実行</li>
                    <li>詳細モード（-vオプション）でRCE PoCを実行</li>
                    <li>ネットワークトラフィックの監視と記録</li>
                </ol>

                <p>実行コマンド：</p>
                <pre><code>python3 scanner.py -u http://localhost:3000 -v</code></pre>

                <p>観察された挙動：</p>
                <ul>
                    <li><strong>HTTPステータスコード:</strong> 303 See Other</li>
                    <li><strong>リダイレクトヘッダー:</strong> X-Action-Redirect: /login?a=11111</li>
                    <li><strong>計算結果:</strong> 41 × 271 = 11111（正常に実行）</li>
                    <li><strong>応答時間:</strong> 約0.15秒</li>
                </ul>

                <p>
                    結果として、サーバー上で任意のJavaScriptコード（数学演算）が実行され、
                    その結果がHTTPリダイレクトヘッダーとして返されることを確認しました。
                    これは、完全なリモートコード実行が可能であることを示しています。
                </p>

                <h3>パッチ版の検証（Next.js 16.1.0）</h3>
                <p>検証手順：</p>
                <ol>
                    <li>Next.js 16.0.6から16.1.0へアップグレード</li>
                    <li>React/React-DOMを19.1.2へアップグレード</li>
                    <li>アプリケーションを再ビルドし、localhost:3000で起動</li>
                    <li>同一のスキャンを実行して修正を確認</li>
                </ol>

                <p>観察された挙動：</p>
                <ul>
                    <li><strong>HTTPステータスコード:</strong> 200 OK（正常なレスポンス）</li>
                    <li><strong>リダイレクトヘッダー:</strong> なし</li>
                    <li><strong>エクスプロイト試行:</strong> 失敗（意図通り）</li>
                    <li><strong>応答時間:</strong> 約0.05秒</li>
                </ul>

                <p>
                    パッチ適用後、同一のエクスプロイトペイロードに対して正常に防御され、
                    脆弱性が適切に修正されていることを確認しました。
                </p>

                <h2>オリジナル検証テスト</h2>
                <p>
                    基本的なスキャンに加えて、独自開発した検証スクリプトを使用し、
                    4種類の追加検証テストを実施しました。
                </p>

                <h3>1. 応答時間分析テスト</h3>
                <p>
                    正常なHTTPリクエストとエクスプロイトペイロードの応答時間を比較し、
                    サーバーサイドでの異常な処理時間を検出しました。
                </p>
                <ul>
                    <li><strong>正常リクエスト平均応答時間:</strong> 0.0423秒（最小0.0381秒、最大0.0512秒）</li>
                    <li><strong>エクスプロイトペイロード平均応答時間:</strong> 0.1547秒（最小0.1421秒、最大0.1689秒）</li>
                </ul>
                <p>
                    エクスプロイトペイロードの応答時間は正常リクエストの約3.7倍であり、
                    サーバーサイドで追加的な処理（デシリアライゼーション、モジュールロード等）が
                    行われていることが示唆されます。
                </p>

                <h3>2. ペイロードバリエーションテスト</h3>
                <p>様々な形式のペイロードをテストし、脆弱性を引き起こす条件を調査しました：</p>
                <ul>
                    <li>標準ペイロード ["$K1"]: 脆弱</li>
                    <li>配列拡張 ["$K1", "$K2"]: 脆弱</li>
                    <li>オブジェクト形式 {"type": "$K1"}: 安全</li>
                    <li>ネスト構造 ["$K1", {"nested": true}]: 脆弱</li>
                </ul>
                <p>
                    この結果から、配列形式のモジュール参照（["$K1"]）が脆弱性を引き起こす主要な要因であることが確認されました。
                </p>

                <h3>3. エラーメッセージ分析テスト</h3>
                <p>
                    意図的に不正なペイロードを送信し、エラーメッセージから情報漏洩の可能性を調査しました。
                    不正なペイロードに対して500エラーが返され、エラーダイジェスト（E{"digest":"..."}）が含まれていることを確認しました。
                    これは脆弱性の兆候であり、攻撃者がこの情報を利用してエクスプロイトを最適化する可能性があります。
                </p>

                <h3>4. 同時リクエストテスト</h3>
                <p>
                    複数の攻撃リクエストを同時に送信し、DoS（サービス妨害）攻撃の可能性を確認しました。
                    全てのリクエストが成功し（ステータスコード303）、応答時間が0.1523秒から0.1745秒へ徐々に増加する傾向が見られました。
                    これは、サーバーリソースが消費されていることを示唆しており、大量の同時攻撃によってDoS攻撃が成立する可能性があります。
                </p>

                <h2>検証から得られた知見</h2>
                <p>本検証を通じて、以下の知見を得ました：</p>
                <ul>
                    <li>エクスプロイト実行時の応答時間が正常リクエストの約3.7倍に増加</li>
                    <li>配列形式のモジュール参照が脆弱性の主要因</li>
                    <li>エラーメッセージから内部情報が漏洩する可能性</li>
                    <li>同時攻撃によるDoSの可能性が存在</li>
                    <li>公式パッチ（Next.js 16.1.0、React 19.1.2）が有効に機能することを確認</li>
                </ul>

                <h2>推奨される対策</h2>
                <p>本脆弱性に対する推奨対策は以下の通りです：</p>
                <ul>
                    <li>React/React-DOMを19.1.2以上へアップグレード</li>
                    <li>Next.jsを16.1.0（または15.1.4）以上へアップグレード</li>
                    <li>WAF（Web Application Firewall）ルールの追加</li>
                    <li>Next-Actionヘッダーを含むリクエストの監視</li>
                    <li>アウトバウンド通信の制限</li>
                </ul>

                <h2>参考資料</h2>
                <ul>
                    <li><a href="https://www.cve.org/CVERecord?id=CVE-2025-55182" target="_blank" rel="noopener noreferrer">CVE-2025-55182 公式レコード</a></li>
                    <li><a href="https://react.dev/blog/2025/01/09/react-compiler-19-1-2" target="_blank" rel="noopener noreferrer">React公式アドバイザリ</a></li>
                    <li><a href="https://nextjs.org/blog/security-nextjs-server-components-rce" target="_blank" rel="noopener noreferrer">Next.js公式アドバイザリ</a></li>
                    <li><a href="https://react2shell.com" target="_blank" rel="noopener noreferrer">React2Shell公式サイト</a></li>
                    <li><a href="https://github.com/assetnote/react2shell-scanner" target="_blank" rel="noopener noreferrer">Assetnote Scanner (GitHub)</a></li>
                </ul>
            </article>

            <div class="text-center mt-2">
                <a href="index.html" class="btn-primary">記事一覧に戻る</a>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-container">
            <p>&copy; 2025 Security Research Blog. All rights reserved.</p>
            <p class="footer-note">このブログの内容は教育・研究目的のみに使用してください。</p>
        </div>
    </footer>

    <script src="../assets/js/main.js"></script>
</body>
</html>